(function(){function e(e){return e.replace(/^\s+|\s+$/g,"")}function t(e){return e.replace(/^\s+/g,"")}function n(e){return e.replace(/\s+$/g,"")}function r(e,r,i,s){function g(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.newlines=0;this.indent_content=u;this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(e,t){for(var n=0;n<t.length;n++){if(e===t[n]){return true}}return false}};this.is_whitespace=function(e){for(var t=0;t<e.length;e++){if(!this.Utils.in_array(e.charAt(t),this.Utils.whitespace)){return false}}return true};this.traverse_whitespace=function(){var e="";e=this.input.charAt(this.pos);if(this.Utils.in_array(e,this.Utils.whitespace)){this.newlines=0;while(this.Utils.in_array(e,this.Utils.whitespace)){if(p&&e==="\n"&&this.newlines<=d){this.newlines+=1}this.pos++;e=this.input.charAt(this.pos)}return true}return false};this.space_or_wrap=function(e){if(this.line_char_count>=this.wrap_line_length){this.print_newline(false,e);this.print_indentation(e)}else{this.line_char_count++;e.push(" ")}};this.get_content=function(){var e="",t=[],n=false;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length){return t.length?t.join(""):["","TK_EOF"]}if(this.traverse_whitespace()){this.space_or_wrap(t);continue}if(v){var r=this.input.substr(this.pos,3);if(r==="{{#"||r==="{{/"){break}else if(this.input.substr(this.pos,2)==="{{"){if(this.get_tag(true)==="{{else}}"){break}}}e=this.input.charAt(this.pos);this.pos++;this.line_char_count++;t.push(e)}return t.length?t.join(""):""};this.get_contents_to=function(e){if(this.pos===this.input.length){return["","TK_EOF"]}var t="";var n="";var r=new RegExp("</"+e+"\\s*>","igm");r.lastIndex=this.pos;var i=r.exec(this.input);var s=i?i.index:this.input.length;if(this.pos<s){n=this.input.substring(this.pos,s);this.pos=s}return n};this.record_tag=function(e){if(this.tags[e+"count"]){this.tags[e+"count"]++;this.tags[e+this.tags[e+"count"]]=this.indent_level}else{this.tags[e+"count"]=1;this.tags[e+this.tags[e+"count"]]=this.indent_level}this.tags[e+this.tags[e+"count"]+"parent"]=this.tags.parent;this.tags.parent=e+this.tags[e+"count"]};this.retrieve_tag=function(e){if(this.tags[e+"count"]){var t=this.tags.parent;while(t){if(e+this.tags[e+"count"]===t){break}t=this.tags[t+"parent"]}if(t){this.indent_level=this.tags[e+this.tags[e+"count"]];this.tags.parent=this.tags[t+"parent"]}delete this.tags[e+this.tags[e+"count"]+"parent"];delete this.tags[e+this.tags[e+"count"]];if(this.tags[e+"count"]===1){delete this.tags[e+"count"]}else{this.tags[e+"count"]--}}};this.indent_to_tag=function(e){if(!this.tags[e+"count"]){return}var t=this.tags.parent;while(t){if(e+this.tags[e+"count"]===t){break}t=this.tags[t+"parent"]}if(t){this.indent_level=this.tags[e+this.tags[e+"count"]]}};this.get_tag=function(e){var t="",n=[],r="",i=false,s,o,u,a=this.pos,f=this.line_char_count;e=e!==undefined?e:false;do{if(this.pos>=this.input.length){if(e){this.pos=a;this.line_char_count=f}return n.length?n.join(""):["","TK_EOF"]}t=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(t,this.Utils.whitespace)){i=true;continue}if(t==="'"||t==='"'){t+=this.get_unformatted(t);i=true}if(t==="="){i=false}if(n.length&&n[n.length-1]!=="="&&t!==">"&&i){this.space_or_wrap(n);i=false}if(v&&u==="<"){if(t+this.input.charAt(this.pos)==="{{"){t+=this.get_unformatted("}}");if(n.length&&n[n.length-1]!==" "&&n[n.length-1]!=="<"){t=" "+t}i=true}}if(t==="<"&&!u){s=this.pos-1;u="<"}if(v&&!u){if(n.length>=2&&n[n.length-1]==="{"&&n[n.length-2]=="{"){if(t==="#"||t==="/"){s=this.pos-3}else{s=this.pos-2}u="{"}}this.line_char_count++;n.push(t);if(n[1]&&n[1]==="!"){n=[this.get_comment(s)];break}if(v&&u==="{"&&n.length>2&&n[n.length-2]==="}"&&n[n.length-1]==="}"){break}}while(t!==">");var l=n.join("");var c;var p;if(l.indexOf(" ")!==-1){c=l.indexOf(" ")}else if(l[0]==="{"){c=l.indexOf("}")}else{c=l.indexOf(">")}if(l[0]==="<"||!v){p=1}else{p=l[2]==="#"?3:2}var d=l.substring(p,c).toLowerCase();if(l.charAt(l.length-2)==="/"||this.Utils.in_array(d,this.Utils.single_token)){if(!e){this.tag_type="SINGLE"}}else if(v&&l[0]==="{"&&d==="else"){if(!e){this.indent_to_tag("if");this.tag_type="HANDLEBARS_ELSE";this.indent_content=true;this.traverse_whitespace()}}else if(this.is_unformatted(d,h)){r=this.get_unformatted("</"+d+">",l);n.push(r);o=this.pos-1;this.tag_type="SINGLE"}else if(d==="script"&&(l.search("type")===-1||l.search("type")>-1&&l.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)){if(!e){this.record_tag(d);this.tag_type="SCRIPT"}}else if(d==="style"&&(l.search("type")===-1||l.search("type")>-1&&l.search("text/css")>-1)){if(!e){this.record_tag(d);this.tag_type="STYLE"}}else if(d.charAt(0)==="!"){if(!e){this.tag_type="SINGLE";this.traverse_whitespace()}}else if(!e){if(d.charAt(0)==="/"){this.retrieve_tag(d.substring(1));this.tag_type="END"}else{this.record_tag(d);if(d.toLowerCase()!=="html"){this.indent_content=true}this.tag_type="START"}if(this.traverse_whitespace()){this.space_or_wrap(n)}if(this.Utils.in_array(d,this.Utils.extra_liners)){this.print_newline(false,this.output);if(this.output.length&&this.output[this.output.length-2]!=="\n"){this.print_newline(true,this.output)}}}if(e){this.pos=a;this.line_char_count=f}return n.join("")};this.get_comment=function(e){var t="",n=">",r=false;this.pos=e;input_char=this.input.charAt(this.pos);this.pos++;while(this.pos<=this.input.length){t+=input_char;if(t[t.length-1]===n[n.length-1]&&t.indexOf(n)!==-1){break}if(!r&&t.length<10){if(t.indexOf("<![if")===0){n="<![endif]>";r=true}else if(t.indexOf("<![cdata[")===0){n="]]>";r=true}else if(t.indexOf("<![")===0){n="]>";r=true}else if(t.indexOf("<!--")===0){n="-->";r=true}}input_char=this.input.charAt(this.pos);this.pos++}return t};this.get_unformatted=function(e,t){if(t&&t.toLowerCase().indexOf(e)!==-1){return""}var n="";var r="";var i=0;var s=true;do{if(this.pos>=this.input.length){return r}n=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(n,this.Utils.whitespace)){if(!s){this.line_char_count--;continue}if(n==="\n"||n==="\r"){r+="\n";this.line_char_count=0;continue}}r+=n;this.line_char_count++;s=true;if(v&&n==="{"&&r.length&&r[r.length-2]==="{"){r+=this.get_unformatted("}}");i=r.length}}while(r.toLowerCase().indexOf(e,i)===-1);return r};this.get_token=function(){var e;if(this.last_token==="TK_TAG_SCRIPT"||this.last_token==="TK_TAG_STYLE"){var t=this.last_token.substr(7);e=this.get_contents_to(t);if(typeof e!=="string"){return e}return[e,"TK_"+t]}if(this.current_mode==="CONTENT"){e=this.get_content();if(typeof e!=="string"){return e}else{return[e,"TK_CONTENT"]}}if(this.current_mode==="TAG"){e=this.get_tag();if(typeof e!=="string"){return e}else{var n="TK_TAG_"+this.tag_type;return[e,n]}}};this.get_full_indent=function(e){e=this.indent_level+e||0;if(e<1){return""}return Array(e+1).join(this.indent_string)};this.is_unformatted=function(e,t){if(!this.Utils.in_array(e,t)){return false}if(e.toLowerCase()!=="a"||!this.Utils.in_array("a",t)){return true}var n=this.get_tag(true);var r=(n||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);if(!r||this.Utils.in_array(r,t)){return true}else{return false}};this.printer=function(e,r,i,s,o){this.input=e||"";this.output=[];this.indent_character=r;this.indent_string="";this.indent_size=i;this.brace_style=o;this.indent_level=0;this.wrap_line_length=s;this.line_char_count=0;for(var u=0;u<this.indent_size;u++){this.indent_string+=this.indent_character}this.print_newline=function(e,t){this.line_char_count=0;if(!t||!t.length){return}if(e||t[t.length-1]!=="\n"){if(t[t.length-1]!=="\n"){t[t.length-1]=n(t[t.length-1])}t.push("\n")}};this.print_indentation=function(e){for(var t=0;t<this.indent_level;t++){e.push(this.indent_string);this.line_char_count+=this.indent_string.length}};this.print_token=function(e){if(this.is_whitespace(e)&&!this.output.length){return}if(e||e!==""){if(this.output.length&&this.output[this.output.length-1]==="\n"){this.print_indentation(this.output);e=t(e)}}this.print_token_raw(e)};this.print_token_raw=function(e){if(this.newlines>0){e=n(e)}if(e&&e!==""){if(e.length>1&&e[e.length-1]==="\n"){this.output.push(e.slice(0,-1));this.print_newline(false,this.output)}else{this.output.push(e)}}for(var t=0;t<this.newlines;t++){this.print_newline(t>0,this.output)}this.newlines=0};this.indent=function(){this.indent_level++};this.unindent=function(){if(this.indent_level>0){this.indent_level--}}};return this}var o,u,a,f,l,c,h,p,d,v,m;r=r||{};if((r.wrap_line_length===undefined||parseInt(r.wrap_line_length,10)===0)&&r.max_char!==undefined&&parseInt(r.max_char,10)!==0){r.wrap_line_length=r.max_char}u=r.indent_inner_html===undefined?false:r.indent_inner_html;a=r.indent_size===undefined?4:parseInt(r.indent_size,10);f=r.indent_char===undefined?" ":r.indent_char;c=r.brace_style===undefined?"collapse":r.brace_style;l=parseInt(r.wrap_line_length,10)===0?32786:parseInt(r.wrap_line_length||250,10);h=r.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"];p=r.preserve_newlines===undefined?true:r.preserve_newlines;d=p?isNaN(parseInt(r.max_preserve_newlines,10))?32786:parseInt(r.max_preserve_newlines,10):0;v=r.indent_handlebars===undefined?false:r.indent_handlebars;m=r.end_with_newline===undefined?false:r.end_with_newline;o=new g;o.printer(e,f,a,l,c);while(true){var y=o.get_token();o.token_text=y[0];o.token_type=y[1];if(o.token_type==="TK_EOF"){break}switch(o.token_type){case"TK_TAG_START":o.print_newline(false,o.output);o.print_token(o.token_text);if(o.indent_content){o.indent();o.indent_content=false}o.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":o.print_newline(false,o.output);o.print_token(o.token_text);o.current_mode="CONTENT";break;case"TK_TAG_END":if(o.last_token==="TK_CONTENT"&&o.last_text===""){var b=o.token_text.match(/\w+/)[0];var w=null;if(o.output.length){w=o.output[o.output.length-1].match(/(?:<|{{#)\s*(\w+)/)}if(w===null||w[1]!==b){o.print_newline(false,o.output)}}o.print_token(o.token_text);o.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var E=o.token_text.match(/^\s*<([a-z-]+)/i);if(!E||!o.Utils.in_array(E[1],h)){o.print_newline(false,o.output)}o.print_token(o.token_text);o.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":o.print_token(o.token_text);if(o.indent_content){o.indent();o.indent_content=false}o.current_mode="CONTENT";break;case"TK_CONTENT":o.print_token(o.token_text);o.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(o.token_text!==""){o.print_newline(false,o.output);var S=o.token_text,x,T=1;if(o.token_type==="TK_SCRIPT"){x=typeof i==="function"&&i}else if(o.token_type==="TK_STYLE"){x=typeof s==="function"&&s}if(r.indent_scripts==="keep"){T=0}else if(r.indent_scripts==="separate"){T=-o.indent_level}var N=o.get_full_indent(T);if(x){S=x(S.replace(/^\s*/,N),r)}else{var C=S.match(/^\s*/)[0];var k=C.match(/[^\n\r]*$/)[0].split(o.indent_string).length-1;var L=o.get_full_indent(T-k);S=S.replace(/^\s*/,N).replace(/\r\n|\r|\n/g,"\n"+L).replace(/\s+$/,"")}if(S){o.print_token_raw(S);o.print_newline(true,o.output)}}o.current_mode="TAG";break;default:if(o.token_text!==""){o.print_token(o.token_text)}break}o.last_token=o.token_type;o.last_text=o.token_text}var A=o.output.join("").replace(/[\r\n\t ]+$/,"");if(m){A+="\n"}return A}if(typeof define==="function"&&define.amd){define(["require","./beautify","./beautify-css"],function(e){var t=e("./beautify");var n=e("./beautify-css");return{html_beautify:function(e,i){return r(e,i,t.js_beautify,n.css_beautify)}}})}else if(typeof exports!=="undefined"){var i=require("./beautify.js");var s=require("./beautify-css.js");exports.html_beautify=function(e,t){return r(e,t,i.js_beautify,s.css_beautify)}}else if(typeof window!=="undefined"){window.html_beautify=function(e,t){return r(e,t,window.js_beautify,window.css_beautify)}}else if(typeof global!=="undefined"){global.html_beautify=function(e,t){return r(e,t,global.js_beautify,global.css_beautify)}}})()